import pandas as pd

data = pd.read_csv("/content/Updated_sales.csv")

print(f"Dataset shape : {data.shape}")

data.head()

#check for null value
print(data.isnull().sum())

#handle missing value
data=data.dropna()

print(data.isnull().sum())

# Check for duplicates
duplicates = data.duplicated().sum()
print(f'Duplicates: {duplicates}')
df_no_duplicates = data.drop_duplicates()

# Convert the 'Order Date' column in the DataFrame to datetime format
data['Order Date'] = pd.to_datetime(data['Order Date'], errors='coerce')

# Number of missing dates
print(data['Order Date'].isna().sum())

# Convert 'Quantity Ordered' column to integer
data['Quantity Ordered'] = data['Quantity Ordered'].astype(int)
# Convert 'Zip code' column to integer
data['Zip code'] = data['Zip code'].astype(int)
# Convert 'Price Each' column to float
data['Price Each'] = data['Price Each'].astype(float)
# 7. Check the data types
print("\nData Types After Cleaning:")

print(data.dtypes)

# Reset index after cleaning
data.reset_index(drop=True, inplace=True)
# 9. Save cleaned data to a new CSV file
data.to_csv('Sales.csv', index=False)
# Display the cleaned data
print("\nCleaned Data:")
print(data.head())

# Extract unique products and assign ProductID
products_df = data[['Product']].drop_duplicates().reset_index(drop=True)
products_df['ProductID'] = products_df.index + 1


# Merge ProductID  back into the original dataframe
df2 = data.merge(products_df, on='Product')
df2.drop(columns=['Purchase Address'], inplace=True)
df2

products_df

#populate data into MySQL server
import mysql.connector
config = {
    'user': 'root',
    'password': '',
    'host': '127.0.0.1',
    'database': 'sales',
    'raise_on_warnings': True
}
conn = mysql.connector.connect(**config)
cursor = conn.cursor()


for _, row in products_df.iterrows():
    cursor.execute(
        "INSERT INTO Products (ProductID, Product) VALUES (%s, %s)",
        (row['ProductID'], row['Product'])
    )



orders_df = df2[['Order ID','Quantity Ordered','Price Each', 'Total Price','Order Date', 'time','Street','City','State','Zip code','ProductID']]
orders_df['Price Each'] = orders_df['Price Each'].astype(float).round(2)
orders_df['Quantity Ordered'] = orders_df['Quantity Ordered'].astype(int)
print(orders_df.head())
print(orders_df.dtypes)


for _, row in orders_df.iterrows():
    cursor.execute(
        "INSERT INTO Orders (OrderID,QuantityOrdered,PriceEach, TotalPrice,OrderDate,Time,Street,City,State,ZipCode,ProductID) VALUES ( %s, %s, %s, %s, %s, %s, %s,%s, %s, %s,%s)",
        (row['Order ID'],row['Quantity Ordered'], row['Price Each'], row['Total Price'], row['Order Date'], row['time'], row['Street'], row['City'], row['State'],row['Zip code'],row['ProductID']))

conn.commit()

cursor.close()
conn.close()

print("Data inserted successfully")
